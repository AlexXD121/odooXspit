{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Kargo/kargo/app/lib/actions/auth-actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { signIn, signOut } from '@/auth';\r\nimport { AuthError } from 'next-auth';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport bcrypt from 'bcryptjs';\r\nimport { z } from 'zod';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\n// Schema for the initial password check\r\nconst PreAuthSchema = z.object({\r\n    email: z.string().email(),\r\n    password: z.string().min(6),\r\n});\r\n\r\nexport async function preAuthenticate(formData: FormData) {\r\n    const email = formData.get('email') as string;\r\n    const password = formData.get('password') as string;\r\n\r\n    console.log('Pre-auth input:', { email, password });\r\n\r\n    const validatedFields = PreAuthSchema.safeParse({ email, password });\r\n\r\n    if (!validatedFields.success) {\r\n        return { error: 'Invalid email or password format.' };\r\n    }\r\n\r\n    try {\r\n        const user = await prisma.user.findUnique({ where: { email } });\r\n        if (!user) return { error: 'Invalid credentials.' };\r\n\r\n        const passwordsMatch = await bcrypt.compare(password, user.password);\r\n        if (!passwordsMatch) return { error: 'Invalid credentials.' };\r\n\r\n        // Generate OTP\r\n        const otp = Math.floor(100000 + Math.random() * 900000).toString();\r\n        const otpExpires = new Date(Date.now() + 5 * 60 * 1000); // 5 minutes\r\n\r\n        // Save OTP to DB\r\n        await prisma.user.update({\r\n            where: { email },\r\n            // @ts-ignore\r\n            data: { otp, otpExpires },\r\n        });\r\n\r\n        console.log(`ðŸ” OTP for ${email}: ${otp}`); // In real app, send via email/SMS\r\n\r\n        return { success: true, message: 'OTP sent to your email.' };\r\n    } catch (error) {\r\n        console.error('Pre-auth error:', error);\r\n        return { error: 'Something went wrong.' };\r\n    }\r\n}\r\n\r\nexport async function authenticate(\r\n    prevState: string | undefined,\r\n    formData: FormData,\r\n) {\r\n    try {\r\n        await signIn('credentials', formData);\r\n    } catch (error) {\r\n        if (error instanceof AuthError) {\r\n            switch (error.type) {\r\n                case 'CredentialsSignin':\r\n                    return 'Invalid OTP or credentials.';\r\n                default:\r\n                    return 'Something went wrong.';\r\n            }\r\n        }\r\n        throw error;\r\n    }\r\n}\r\n\r\nconst RegisterSchema = z.object({\r\n    name: z.string().min(2, { message: 'Name must be at least 2 characters long.' }),\r\n    email: z.string().email({ message: 'Please enter a valid email address.' }),\r\n    password: z.string().min(6, { message: 'Password must be at least 6 characters long.' }),\r\n    confirmPassword: z.string()\r\n}).refine((data) => data.password === data.confirmPassword, {\r\n    message: \"Passwords don't match\",\r\n    path: [\"confirmPassword\"],\r\n});\r\n\r\nexport interface RegisterState {\r\n    error?: {\r\n        name?: string[];\r\n        email?: string[];\r\n        password?: string[];\r\n        confirmPassword?: string[];\r\n        form?: string[];\r\n    };\r\n    success?: boolean;\r\n    message?: string;\r\n}\r\n\r\nexport async function registerUser(prevState: RegisterState, formData: FormData): Promise<RegisterState> {\r\n    const name = formData.get('name') as string;\r\n    const email = formData.get('email') as string;\r\n    const password = formData.get('password') as string;\r\n    const confirmPassword = formData.get('confirmPassword') as string;\r\n\r\n    const validatedFields = RegisterSchema.safeParse({ name, email, password, confirmPassword });\r\n\r\n    if (!validatedFields.success) {\r\n        return { error: validatedFields.error.flatten().fieldErrors };\r\n    }\r\n\r\n    try {\r\n        const existingUser = await prisma.user.findUnique({ where: { email } });\r\n        if (existingUser) {\r\n            return { error: { email: ['Email already in use.'] } };\r\n        }\r\n\r\n        const hashedPassword = await bcrypt.hash(password, 10);\r\n\r\n        await prisma.user.create({\r\n            data: {\r\n                name,\r\n                email,\r\n                password: hashedPassword,\r\n                role: 'USER', // Default role\r\n            },\r\n        });\r\n\r\n        return { success: true, message: 'Account created successfully. Please log in.' };\r\n    } catch (error) {\r\n        console.error('Registration error:', error);\r\n        return { error: { form: ['Something went wrong. Please try again.'] } };\r\n    }\r\n}\r\n\r\nexport async function signOutAction() {\r\n    await signOut();\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///D:/Kargo/kargo/app/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n    globalForPrisma.prisma ||\r\n    new PrismaClient({\r\n        log: ['query'],\r\n    });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACT,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACb,KAAK;QAAC;KAAQ;AAClB;AAEJ,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 211, "column": 0}, "map": {"version":3,"sources":["file:///D:/Kargo/kargo/app/lib/services.ts"],"sourcesContent":["import { prisma } from './prisma';\r\n\r\n// --- Product Services ---\r\n\r\nexport async function createProductService(data: {\r\n    name: string;\r\n    sku: string;\r\n    category: string;\r\n    description?: string;\r\n    minStock: number;\r\n}) {\r\n    const existing = await prisma.product.findUnique({\r\n        where: { sku: data.sku },\r\n    });\r\n\r\n    if (existing) {\r\n        throw new Error('Product with this SKU already exists');\r\n    }\r\n\r\n    return await prisma.product.create({\r\n        data: {\r\n            ...data,\r\n            currentStock: 0,\r\n        },\r\n    });\r\n}\r\n\r\nexport async function getProductStockService(productId: string) {\r\n    const product = await prisma.product.findUnique({\r\n        where: { id: productId },\r\n        select: { currentStock: true },\r\n    });\r\n    return product?.currentStock || 0;\r\n}\r\n\r\n// --- Operations Services ---\r\n\r\nasync function generateOperationReference(type: 'RECEIPT' | 'DELIVERY' | 'ADJUSTMENT') {\r\n    const count = await prisma.operation.count({\r\n        where: { type },\r\n    });\r\n    const code = type === 'RECEIPT' ? 'IN' : type === 'DELIVERY' ? 'OUT' : 'ADJ';\r\n    return `WH/${code}/${(count + 1).toString().padStart(4, '0')}`;\r\n}\r\n\r\nexport async function createInboundOperationService(items: { productId: string; quantity: number }[]) {\r\n    const vendor = await prisma.location.findFirst({ where: { type: 'VENDOR' } });\r\n    const warehouse = await prisma.location.findFirst({ where: { type: 'INTERNAL' } });\r\n\r\n    if (!vendor || !warehouse) throw new Error('Missing default locations');\r\n\r\n    const reference = await generateOperationReference('RECEIPT');\r\n\r\n    return await prisma.operation.create({\r\n        data: {\r\n            type: 'RECEIPT',\r\n            status: 'DRAFT',\r\n            reference,\r\n            moves: {\r\n                create: items.map((item) => ({\r\n                    productId: item.productId,\r\n                    quantity: item.quantity,\r\n                    sourceLocationId: vendor.id,\r\n                    destLocationId: warehouse.id,\r\n                    status: 'DRAFT',\r\n                })),\r\n            },\r\n        },\r\n    });\r\n}\r\n\r\nexport async function createOutboundOperationService(items: { productId: string; quantity: number }[]) {\r\n    const warehouse = await prisma.location.findFirst({ where: { type: 'INTERNAL' } });\r\n    const customer = await prisma.location.findFirst({ where: { type: 'CUSTOMER' } });\r\n\r\n    if (!warehouse || !customer) throw new Error('Missing default locations');\r\n\r\n    const reference = await generateOperationReference('DELIVERY');\r\n\r\n    return await prisma.operation.create({\r\n        data: {\r\n            type: 'DELIVERY',\r\n            status: 'DRAFT',\r\n            reference,\r\n            moves: {\r\n                create: items.map((item) => ({\r\n                    productId: item.productId,\r\n                    quantity: item.quantity,\r\n                    sourceLocationId: warehouse.id,\r\n                    destLocationId: customer.id,\r\n                    status: 'DRAFT',\r\n                })),\r\n            },\r\n        },\r\n    });\r\n}\r\n\r\nexport async function createAdjustmentOperationService(items: { productId: string; quantity: number }[], type: 'GAIN' | 'LOSS') {\r\n    const warehouse = await prisma.location.findFirst({ where: { type: 'INTERNAL' } });\r\n    const inventoryLoss = await prisma.location.findFirst({ where: { type: 'INVENTORY_LOSS' } });\r\n\r\n    if (!warehouse || !inventoryLoss) throw new Error('Missing default locations');\r\n\r\n    const reference = await generateOperationReference('ADJUSTMENT');\r\n\r\n    const sourceId = type === 'GAIN' ? inventoryLoss.id : warehouse.id;\r\n    const destId = type === 'GAIN' ? warehouse.id : inventoryLoss.id;\r\n\r\n    return await prisma.operation.create({\r\n        data: {\r\n            type: 'ADJUSTMENT',\r\n            status: 'DRAFT',\r\n            reference,\r\n            moves: {\r\n                create: items.map((item) => ({\r\n                    productId: item.productId,\r\n                    quantity: item.quantity,\r\n                    sourceLocationId: sourceId,\r\n                    destLocationId: destId,\r\n                    status: 'DRAFT',\r\n                })),\r\n            },\r\n        },\r\n    });\r\n}\r\n\r\nexport async function validateOperationService(operationId: string) {\r\n    return await prisma.$transaction(async (tx: any) => {\r\n        const operation = await tx.operation.findUnique({\r\n            where: { id: operationId },\r\n            include: {\r\n                moves: {\r\n                    include: {\r\n                        product: true,\r\n                        sourceLocation: true,\r\n                        destLocation: true\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        if (!operation) throw new Error('Operation not found');\r\n        if (operation.status === 'DONE') throw new Error('Operation already validated');\r\n\r\n        // 1. Check Stock Availability for Outgoing Moves\r\n        for (const move of operation.moves) {\r\n            if (move.sourceLocation.type === 'INTERNAL' && move.destLocation.type !== 'INTERNAL') {\r\n                if (move.product.currentStock < move.quantity) {\r\n                    throw new Error(`Insufficient stock for ${move.product.name} (Requested: ${move.quantity}, Available: ${move.product.currentStock})`);\r\n                }\r\n            }\r\n        }\r\n\r\n        // 2. Update Operation and Moves Status\r\n        await tx.operation.update({\r\n            where: { id: operationId },\r\n            data: { status: 'DONE' },\r\n        });\r\n\r\n        await tx.stockMove.updateMany({\r\n            where: { operationId },\r\n            data: { status: 'DONE' },\r\n        });\r\n\r\n        // 3. Update Product Stock based on Locations\r\n        for (const move of operation.moves) {\r\n            let adjustment = 0;\r\n\r\n            const isSourceInternal = move.sourceLocation.type === 'INTERNAL';\r\n            const isDestInternal = move.destLocation.type === 'INTERNAL';\r\n\r\n            if (isDestInternal && !isSourceInternal) {\r\n                // Incoming (Receipt or Gain)\r\n                adjustment = move.quantity;\r\n            } else if (isSourceInternal && !isDestInternal) {\r\n                // Outgoing (Delivery or Loss)\r\n                adjustment = -move.quantity;\r\n            }\r\n            // Internal Transfer (Internal -> Internal) results in 0 net change for the product globally, \r\n            // but if we tracked stock per location, we would handle it here. \r\n            // Since Product.currentStock is global, we ignore transfers.\r\n\r\n            if (adjustment !== 0) {\r\n                await tx.product.update({\r\n                    where: { id: move.productId },\r\n                    data: { currentStock: { increment: adjustment } },\r\n                });\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// --- Ledger & Analytics Services ---\r\n\r\nexport async function getMoveHistoryService(productId?: string) {\r\n    const where = productId ? { productId } : {};\r\n    return await prisma.stockMove.findMany({\r\n        where,\r\n        include: {\r\n            sourceLocation: true,\r\n            destLocation: true,\r\n            operation: true,\r\n            product: true,\r\n        },\r\n        orderBy: { createdAt: 'desc' },\r\n    });\r\n}\r\n\r\nexport async function getLocationsService(type?: 'INTERNAL' | 'EXTERNAL') {\r\n    const where = type === 'INTERNAL'\r\n        ? { type: 'INTERNAL' }\r\n        : type === 'EXTERNAL'\r\n            ? { type: { in: ['VENDOR', 'CUSTOMER'] } }\r\n            : {};\r\n\r\n    return await prisma.location.findMany({\r\n        where,\r\n        orderBy: { name: 'asc' }\r\n    });\r\n}\r\n\r\nexport async function getDashboardMetricsService() {\r\n    const [pendingOps, products] = await Promise.all([\r\n        prisma.operation.count({ where: { status: 'DRAFT' } }),\r\n        prisma.product.findMany(),\r\n    ]);\r\n\r\n    const lowStockCount = products.filter((p: { currentStock: number; minStock: number; }) => p.currentStock < p.minStock).length;\r\n    const totalValue = 0;\r\n    const totalProducts = products.length;\r\n\r\n    return {\r\n        pendingOps,\r\n        lowStockCount,\r\n        totalValue,\r\n        totalProducts,\r\n    };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 493, "column": 0}, "map": {"version":3,"sources":["file:///D:/Kargo/kargo/app/actions.ts"],"sourcesContent":["'use server';\r\n\r\nimport { revalidatePath } from 'next/cache';\r\nimport {\r\n    createProductService,\r\n    getProductStockService,\r\n    createInboundOperationService,\r\n    createOutboundOperationService,\r\n    createAdjustmentOperationService,\r\n    validateOperationService,\r\n    getMoveHistoryService,\r\n    getDashboardMetricsService,\r\n    getLocationsService\r\n} from './lib/services';\r\n\r\n// --- Product Management ---\r\n\r\nexport async function createProduct(formData: FormData) {\r\n    const name = formData.get('name') as string;\r\n    const sku = formData.get('sku') as string;\r\n    const category = formData.get('category') as string;\r\n    const description = formData.get('description') as string;\r\n    const minStock = parseInt(formData.get('minStock') as string) || 0;\r\n\r\n    if (!name || !sku || !category) {\r\n        return { error: 'Missing required fields' };\r\n    }\r\n\r\n    try {\r\n        await createProductService({ name, sku, category, description, minStock });\r\n        revalidatePath('/stock');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Failed to create product:', error);\r\n        return { error: error.message || 'Failed to create product' };\r\n    }\r\n}\r\n\r\nexport async function getProductStock(productId: string) {\r\n    try {\r\n        return await getProductStockService(productId);\r\n    } catch (error) {\r\n        console.error('Failed to get product stock:', error);\r\n        return 0;\r\n    }\r\n}\r\n\r\n// --- Operations Engine ---\r\n\r\nexport async function createInboundOperation(items: { productId: string; quantity: number }[]) {\r\n    try {\r\n        const operation = await createInboundOperationService(items);\r\n        revalidatePath('/operations/receipts');\r\n        return { success: true, operationId: operation.id };\r\n    } catch (error: any) {\r\n        console.error('Failed to create inbound operation:', error);\r\n        return { error: error.message || 'Failed to create inbound operation' };\r\n    }\r\n}\r\n\r\nexport async function createOutboundOperation(items: { productId: string; quantity: number }[]) {\r\n    try {\r\n        const operation = await createOutboundOperationService(items);\r\n        revalidatePath('/operations/deliveries');\r\n        return { success: true, operationId: operation.id };\r\n    } catch (error: any) {\r\n        console.error('Failed to create outbound operation:', error);\r\n        return { error: error.message || 'Failed to create outbound operation' };\r\n    }\r\n}\r\n\r\nexport async function createAdjustmentOperation(items: { productId: string; quantity: number }[], type: 'GAIN' | 'LOSS') {\r\n    try {\r\n        const operation = await createAdjustmentOperationService(items, type);\r\n        revalidatePath('/operations/adjustment');\r\n        return { success: true, operationId: operation.id };\r\n    } catch (error: any) {\r\n        console.error('Failed to create adjustment operation:', error);\r\n        return { error: error.message || 'Failed to create adjustment operation' };\r\n    }\r\n}\r\n\r\nexport async function validateOperation(operationId: string) {\r\n    try {\r\n        await validateOperationService(operationId);\r\n        revalidatePath('/stock');\r\n        revalidatePath('/operations');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Validation failed:', error);\r\n        return { error: error.message || 'Validation failed' };\r\n    }\r\n}\r\n\r\n// --- Ledger & Analytics ---\r\n\r\nexport async function getMoveHistory(productId?: string) {\r\n    try {\r\n        return await getMoveHistoryService(productId);\r\n    } catch (error) {\r\n        console.error('Failed to fetch move history:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function getLocations(type?: 'INTERNAL' | 'EXTERNAL') {\r\n    try {\r\n        return await getLocationsService(type);\r\n    } catch (error) {\r\n        console.error('Failed to fetch locations:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function getDashboardMetrics() {\r\n    try {\r\n        return await getDashboardMetricsService();\r\n    } catch (error) {\r\n        console.error('Failed to fetch dashboard metrics:', error);\r\n        return { pendingOps: 0, lowStockCount: 0, totalValue: 0, totalProducts: 0 };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAEA;AACA;;;;;AAcO,eAAe,cAAc,QAAkB;IAClD,MAAM,OAAO,SAAS,GAAG,CAAC;IAC1B,MAAM,MAAM,SAAS,GAAG,CAAC;IACzB,MAAM,WAAW,SAAS,GAAG,CAAC;IAC9B,MAAM,cAAc,SAAS,GAAG,CAAC;IACjC,MAAM,WAAW,SAAS,SAAS,GAAG,CAAC,gBAA0B;IAEjE,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU;QAC5B,OAAO;YAAE,OAAO;QAA0B;IAC9C;IAEA,IAAI;QACA,MAAM,IAAA,8IAAoB,EAAC;YAAE;YAAM;YAAK;YAAU;YAAa;QAAS;QACxE,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAK;IAC3B,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO;YAAE,OAAO,MAAM,OAAO,IAAI;QAA2B;IAChE;AACJ;AAEO,eAAe,gBAAgB,SAAiB;IACnD,IAAI;QACA,OAAO,MAAM,IAAA,gJAAsB,EAAC;IACxC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;IACX;AACJ;AAIO,eAAe,uBAAuB,KAAgD;IACzF,IAAI;QACA,MAAM,YAAY,MAAM,IAAA,uJAA6B,EAAC;QACtD,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;YAAM,aAAa,UAAU,EAAE;QAAC;IACtD,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,uCAAuC;QACrD,OAAO;YAAE,OAAO,MAAM,OAAO,IAAI;QAAqC;IAC1E;AACJ;AAEO,eAAe,wBAAwB,KAAgD;IAC1F,IAAI;QACA,MAAM,YAAY,MAAM,IAAA,wJAA8B,EAAC;QACvD,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;YAAM,aAAa,UAAU,EAAE;QAAC;IACtD,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,wCAAwC;QACtD,OAAO;YAAE,OAAO,MAAM,OAAO,IAAI;QAAsC;IAC3E;AACJ;AAEO,eAAe,0BAA0B,KAAgD,EAAE,IAAqB;IACnH,IAAI;QACA,MAAM,YAAY,MAAM,IAAA,0JAAgC,EAAC,OAAO;QAChE,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;YAAM,aAAa,UAAU,EAAE;QAAC;IACtD,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,0CAA0C;QACxD,OAAO;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwC;IAC7E;AACJ;AAEO,eAAe,kBAAkB,WAAmB;IACvD,IAAI;QACA,MAAM,IAAA,kJAAwB,EAAC;QAC/B,IAAA,+IAAc,EAAC;QACf,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAK;IAC3B,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO;YAAE,OAAO,MAAM,OAAO,IAAI;QAAoB;IACzD;AACJ;AAIO,eAAe,eAAe,SAAkB;IACnD,IAAI;QACA,OAAO,MAAM,IAAA,+IAAqB,EAAC;IACvC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,EAAE;IACb;AACJ;AAEO,eAAe,aAAa,IAA8B;IAC7D,IAAI;QACA,OAAO,MAAM,IAAA,6IAAmB,EAAC;IACrC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,EAAE;IACb;AACJ;AAEO,eAAe;IAClB,IAAI;QACA,OAAO,MAAM,IAAA,oJAA0B;IAC3C,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO;YAAE,YAAY;YAAG,eAAe;YAAG,YAAY;YAAG,eAAe;QAAE;IAC9E;AACJ;;;IAxGsB;IAqBA;IAWA;IAWA;IAWA;IAWA;IAcA;IASA;IASA;;AAjGA,+OAAA;AAqBA,+OAAA;AAWA,+OAAA;AAWA,+OAAA;AAWA,+OAAA;AAWA,+OAAA;AAcA,+OAAA;AASA,+OAAA;AASA,+OAAA"}},
    {"offset": {"line": 672, "column": 0}, "map": {"version":3,"sources":["file:///D:/Kargo/kargo/.next-internal/server/app/settings/locations/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {preAuthenticate as '401024374ad4e484a00123d87e1aaee226eb95a960'} from 'ACTIONS_MODULE0'\nexport {authenticate as '60be66a202d772940bea322562258910466041fa00'} from 'ACTIONS_MODULE0'\nexport {registerUser as '6095436ed47bcbf1e0a77f7eb6a6084305dc033d5c'} from 'ACTIONS_MODULE0'\nexport {signOutAction as '000e01556ed40dbc2a4f10777b9e7c673edf275859'} from 'ACTIONS_MODULE0'\nexport {getDashboardMetrics as '0016c8120f9009f4a87b0d37e24b36dad80477c120'} from 'ACTIONS_MODULE1'\nexport {getLocations as '401772c577b74bd4ab889c1cb11551e912e050bbcb'} from 'ACTIONS_MODULE1'\nexport {createInboundOperation as '40207462081fcc84cc43cadd17ad95569a77ab2b5b'} from 'ACTIONS_MODULE1'\nexport {createOutboundOperation as '40604df31221140e14e2c9468f445f65f27f5919af'} from 'ACTIONS_MODULE1'\nexport {getProductStock as '40632b14e37277dcda8d38d3406f36974835ba43dd'} from 'ACTIONS_MODULE1'\nexport {createProduct as '40837ef7ec831e073c38bca7d75b4f9cff0576ce16'} from 'ACTIONS_MODULE1'\nexport {getMoveHistory as '40ad921f224ca355b12ef8953e4ee471470a1e280f'} from 'ACTIONS_MODULE1'\nexport {validateOperation as '40e000839fcd55f8dfe61a6ae04d68d3e4924fe9d9'} from 'ACTIONS_MODULE1'\nexport {createAdjustmentOperation as '60dc17ef2862454028307249aa3abe22891acbf010'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AAIA"}}]
}